#summary Движок Галактики.

= <font color="red">ИЗМЕНЕНО</font> =

Движок галактики был удален, так как в нём нет необходимости. Всё управление планетами производится движком планет.

На самом деле, после продолжительных раздумий, я пришёл к выводу, что поля обломков - это просто другой тип планеты. На эту идею меня подтолкнула страница `Империя`. У этой страницы есть $GET параметр - `planettype`. Для показа планет planettype=1, для показа лун - planettype=3. Очевидно, что planettype=2 используется для чего-то ещё. Ничего, кроме ПО это быть не может.

Теперь картина принимает стройный вид (у удалённых планет хозяином ПО является space, чистка ПО и прочее).

= Introduction =

<img src="http://ogamespec.com/imgstore/whc4d774d5164129.jpg">

Движок предназначен для быстрого отображения планет системы, а также для управления полями обломков и подбора координат стартовой планеты для нового игрока.

Программный модуль находится в файле `game/galaxy.php`

Основные объекты галактики:
 * Планеты. Сами планеты находятся в таблице `planets`. В таблице `galaxy` содержится только пометка что позиция занята планетой. Планеты принадлежат либо определенному игроку, либо тех. аккаунту `space` (уничтоженные планеты)
 * Луны
 * Поля обломков. ПО принадлежат либо реальному игроку, либо тех. аккаунту `space`, если планета на этих координатах была уничтожена. Если в ПО менее 400 ед. ресурсов любого вида, то оно становится невидимым. Даже если в ПО находится 0 металла и 0 кристалла, его всё равно можно переработать. ПО исчезает в понедельник в 1:10 по серверу, если на/от него не летит ни одного флота и если там 0 ресурсов.

*Откуда такие предположения в работе Галактики?*<br>
Были замечены следующие факты в оригинальной игре: 
 * Иногда при колонизации новой планеты или регистрации в старой вселенной, у планеты появляется поле обломков. Это происходит из-за того, что на месте удаленной планеты было ненулевое ПО и оно не удалилось. В Галактике не показываются ненулевые ПО, у которых нет планет (Примечание: в редизайне показываются)
 * При попытке атаки уничтоженной планеты в качестве дефа выступает игрок `space`. Это значит, что после удаления хозяином планеты становится тех. аккаунт `space`.
 * Иногда можно было переработать пустое место в галактике. Это связано с пунктом 1. Хозяином этого пустого ПО был игрок `space`.

По этим фактам стало понятно, что данные о ПО не хранятся в таблице `planets`, так как если бы удалялась планета, то удалялось бы и ПО.

= Алгоритм образования Главной планеты =

= Database =

Структура таблицы `galaxy`:

|| *столбец* || *SQL тип* || *описание* ||
||g||INT||Номер галактики||
||s||INT||Номер системы||
||p||INT||Номер позиции||
||planet_id||INT||Позиция занята планетой, если planet_id != 0||
||moon_id||INT||Позиция занята луной, если moon_id != 0||
||debris||INT||1: на позиции есть поле обломков||
||dm||DOUBLE||Количество металла в ПО (может быть 0)||
||dk||DOUBLE||Количество кристалла в ПО (может быть 0)||