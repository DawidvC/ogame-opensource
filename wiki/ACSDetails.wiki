#summary Описание механизма САБ-атак

= Introduction =

В данной заметке будет находится любая информация, связанная с САБ.

Для начала напомню структуру используемых таблиц в БД:

Запись в очереди событий `queue` :

|| *поле* || *тип* || *описание* ||
||task_id||INT PRIMARY KEY||уникальный номер задания||
||owner_id||INT||номер пользователя которому принадлежит задание||
||type||CHAR(20)||тип задания, каждый тип имеет свой обработчик<br>в случае заданий флота type=Fleet||
||sub_id||INT||дополнительный номер, разный у каждого типа задания<br>для задания флота - ID флота (fleet_id)||
||obj_id||INT||дополнительный номер, разный у каждого типа задания<br>для флота не используется||
||level||INT||для флота не используется||
||start||INT UNSIGNED||время начала задания||
||end||INT UNSIGNED||время окончания задания||
||prio||INT||приоритет события||

Запись в таблице флотов `fleet` :

|| *поле* || *тип* || *описание* ||
||fleet_id||INT PRIMARY KEY||Порядковый номер флота в таблице||
||owner_id||INT||Номер пользователя, которому принадлежит флот||
||union_id||INT||Номер союза, в котором летит флот||
||m, k, d||DOUBLE||Перевозимый груз (металл/кристалл/дейтерий)||
||fuel||DOUBLE||Загруженное топливо на полёт (дейтерий)||
||mission||INT||Тип задания||
||start_planet||INT||ID стартовой планеты||
||target_planet||INT||ID целевой планеты||
||deploy_time||INT||Время удержания флота в секундах||
||shipXX||INT||количество кораблей каждого типа XX=202...215||

Запись в таблице союзов `union` :

|| *поле* || *тип* || *описание* ||
||union_id||INT PRIMARY KEY||ID союза||
||fleet_id||INT||ID головного флота САБа (исходной Атаки)||
||name||CHAR(20)||название союза. по умолчанию: "KV" + число||
||players||TEXT||ID приглашенных игроков, через запятую||

Каждое задание флота оформляется в виде задания для очереди событий (тип "Fleet").

= Создание союза =

 # Создается обычная Атака (fleet_id = 10000, union_id = 0)
 # При нажатии на кнопку "Союз" у этого флота, добавляется новая запись в таблице union. Поле union_id у флота fleet_id = 10000 становится отличным от нуля. Поле fleet_id в записи союза также обновляется. Данная Атака становится "паровозом" САБа.

Общее время полёта союза = queue->end - queue->start.<br>
Прошедшее время полёта союза = queue->end - time().

= Добавление совместных атак в союз =

= Удаление союза =