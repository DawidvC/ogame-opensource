#summary Движок управления пользователями

= Introduction =

Add your content here.

= Сессии =

Сессия - это механизм распознания пользователей. В системе аутентификации пользователей Ogame используются два типа сессии - публичная и приватная.

Публичная сессия - это набор цифр и букв, которые вы можете видеть в каждой игровой ссылке, например `http://uni5.ogame.ru/game/index.php?page=overview&session=356dd05e994d`<br>
Приватная сессия хранится в кукисах вашего браузера. Кукис называется prsess_XXX, где XXX номер пользователя.<br>
В целях безопасности приватная сессия хранится всего-лишь 24 часа, кроме того все сессии удаляются каждую ночь, в 3:00 по серверу, во время так называемого "перелогина".

После входа в игру каждому пользователю назначается уникальная приватная и публичная сессия. Приватная сессия записывается в кукисы, а публичная подставляется ко всем игровым ссылкам.

Алгоритм проверки пользователя в игре осуществляется следующим образом:
 # Из ссылки берется публичная сессия
 # В базе данных находится пользователь, которому назначена такая-же публичная сессия. Если публичная сессия не принадлежит никому, то открывается главная страница OGame.
 # Далее проверяется приватная сессия. Если приватная сессия из кукисов не совпадает с приватной сессией, записанной в базе данных пользователя, то выводится всем известная страница "Произошла ошбка. Сессия недействительна."
 # Затем, если в настройках включена проверка IP адреса, то сравнивается текущий IP-адрес пользователя, и IP-адрес, который у него был на момент входа в игру. Если IP-адреса не совпадают, то выводится та же самая страница с ошибкой.
 # Если все проверки прошли успешно, загружается игровая страница.

= API =

SendGreetingsMail
SendChangeMail
SendGreetingsMessage
IsUserExist
IsEmailExist
CreateUser
RemoveUser
ValidateUser
CheckPassword
ChangeEmail
ChangeActivationCode
SelectPlanet
LoadUser
UpdateLastClick
IsPlayerNewbie
IsPlayerStrong

= Database =

Структура таблицы `users`:

|| *столбец* || *SQL тип* || *описание* ||
||player_id||INT PRIMARY KEY||Порядковый номер пользователя||
||regdate||INT UNSIGNED||Дата регистрации аккаунта time()||
||ally_id||INT||Номер альянса в котором состоит игрок (0 - без альянса)||
||joindate||INT UNSIGNED||Дата вступления в альянс time()||
||allyrank||INT||Ранг игрока в альянсе||
||session||CHAR (12)||Сессия для ссылок||
||private_session||CHAR(32)||Приватная сессия для кукисов||
||name||CHAR(20)||Имя пользователя lower-case для сравнения||
||oname||CHAR(20)||Имя пользователя оригинальное||
||name_changed||INT||Имя пользователя изменено? (1 или 0)||
|| *Q* name_until||INT UNSIGNED||Когда можно поменять имя пользователя в следующий раз time()||
||password||CHAR(32)||MD5-хеш пароля и секретного слова||
||pemail||CHAR(50)||Постоянный почтовый адрес||
||email||CHAR(50)||Временный почтовый адрес||
||email_changed||INT||Временный почтовый адрес изменен||
|| *Q* email_until||INT UNSIGNED||Когда заменить постоянный email на временный time()||
||disable||INT||Аккаунт поставлен на удаление||
|| *Q* disable_until||INT UNSIGNED||Когда можно удалить аккаунт time()||
||vacation||INT||Аккаунт в режиме отпуска||
||vacation_until||INT UNSIGNED||Когда можно выключить режим отпуска time()||
||banned||INT||Аккаунт заблокирован||
|| *Q* banned_until||INT UNSIGNED||Время окончания блокировки time()||
||noattack||INT||Запрет на атаки||
|| *Q* noattack_until||INT UNSIGNED||Когда заканчивается запрет на атаки time()||
||lastlogin||INT UNSIGNED||Последняя дата входа в игру||
||lastclick||INT UNSIGNED||Последний щелчок мышкой, для определения активности игрока||
||ip_addr||CHAR(15)||IP адрес пользователя||
||validated||INT||Пользователь активирован. Если пользователь не активирован, то ему запрещено посылать игровые сообщения и заявки в альянсы.||
||validatemd||CHAR(32)||Код активации||
||hplanetid||INT||Порядковый номер Главной планеты||
||admin||INT||0 - обычный игрок, 1 - оператор, 2 - администратор||
||sortby||INT||Порядок сортировки планет: 0 - порядку колонизации, 1 - координатам, 2 - алфавиту||
||sortorder||INT||Порядок: 0 - по возрастанию, 1 - по убыванию||
||skin||CHAR(80)||Путь для скина. Получается путем слепления пути к хосту и названием скина, но длина строки не более 80 символов.||
||useskin||INT||Показывать скин, если 0 - то показывать скин по умолчанию||
||deact_ip||INT||Выключить проверку IP||
||maxspy||INT||Кол-во шпионских зондов (1 по умолчанию, 0...99)||
||maxfleetmsg||INT||Максимальные сообщения о флоте в Галактику (3 по умолчанию, 0...99, 0=1)||
||aktplanet||INT||Текущая выбранная планета.||
||dm||INT||Покупная ТМ||
||dmfree||INT||ТМ найденная в экспедиции||
||sniff||INT||Включить слежение за историей переходов (Админка)||
||score1,2,3||BIGINT UNSIGNED, INT UNSIGNED, INT UNSIGNED||Очки за постройки, флот, исследования||
||place1,2,3||INT||Место за постройки, флот, исследования||
||oldscore1,2,3||BIGINT UNSIGNED, INT UNSIGNED, INT UNSIGNED||Старые очки за постройки, флот, исследования||
||oldplace1,2,3||INT||старое место за постройки, флот, исследования||
||scoredate||INT UNSIGNED||Время сохранения старой статистики||
||rXXX||INT||Уровень исследования XXX||

*Q* - для обработки этого события используется задание в очереди задач.